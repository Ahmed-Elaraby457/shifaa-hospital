<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>متابعة الحالات</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    :root{
      --blue1:#0077b6;
      --blue2:#0096c7;
      --bg:#f0fbff;
      --red:#e63946;
    }
    *{box-sizing:border-box;}
    body{
      font-family:'Cairo',sans-serif;
      background:var(--bg);
      margin:0;
      padding:0;
      color:#023047;
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
    }
    header{
      background:linear-gradient(135deg,var(--blue1),var(--blue2));
      color:white;
      text-align:center;
      padding:25px;
      box-shadow:0 4px 15px rgba(0,0,0,0.1);
      width:100%;
    }
    header h1{margin:0;font-size:2rem;}
    nav{
      display:flex;
      justify-content:center;
      background:white;
      padding:10px;
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
      width:100%;
      flex-wrap:wrap;
    }
    nav a{
      color:var(--blue1);
      margin:5px 10px;
      text-decoration:none;
      font-weight:bold;
      transition:0.3s;
    }
    nav a:hover{color:#023e8a;}
    main{
      background:white;
      border-radius:20px;
      padding:30px;
      margin:40px 20px;
      max-width:900px;
      width:100%;
      box-shadow:0 4px 15px rgba(0,0,0,0.1);
    }
    h2{text-align:center;color:var(--blue1);}
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
    }
    th,td{
      padding:12px;
      text-align:center;
      border-bottom:1px solid #ddd;
    }
    th{
      background:#e0f7ff;
      color:#023047;
    }
    tr:hover{background:#f7faff;}
    button{
      background:var(--blue1);
      color:white;
      border:none;
      padding:8px 15px;
      border-radius:6px;
      cursor:pointer;
      transition:0.3s;
    }
    button:hover{background:var(--blue2);}
    .delete-btn{
      background:var(--red);
    }
    .delete-btn:hover{
      background:#c1121f;
    }
    form{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:10px;
      margin-bottom:25px;
    }
    input,textarea{
      padding:10px;
      border:1px solid #ccc;
      border-radius:6px;
      font-family:'Cairo',sans-serif;
      width:100%;
    }
    #searchInput{
      width:100%;
      padding:10px;
      margin:10px 0 25px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:1rem;
    }
    #popup, #confirmDelete{
      position:fixed;
      top:0;left:0;
      width:100%;height:100%;
      background:rgba(0,0,0,0.4);
      display:flex;
      justify-content:center;
      align-items:center;
      visibility:hidden;
      opacity:0;
      transition:0.4s;
      z-index:10;
    }
    #popup.active, #confirmDelete.active{
      visibility:visible;
      opacity:1;
    }
    .popup-content{
      background:white;
      padding:25px;
      border-radius:15px;
      width:90%;
      max-width:400px;
      box-shadow:0 0 20px rgba(0,0,0,0.2);
      text-align:center;
      animation:fadeIn 0.4s ease;
      position:relative;
    }
    @keyframes fadeIn{
      from{transform:scale(0.8);opacity:0;}
      to{transform:scale(1);opacity:1;}
    }
    .popup-content textarea{
      width:100%;
      height:120px;
      resize:none;
      padding:10px;
      border:1px solid #ccc;
      border-radius:8px;
      font-family:'Cairo',sans-serif;
      margin-top:10px;
    }
    .close-btn{
      position:absolute;
      top:10px;
      left:15px;
      font-size:1.3rem;
      cursor:pointer;
      color:#555;
    }
    .close-btn:hover{color:#000;}
    footer{
      margin-top:auto;
      background:var(--blue1);
      color:white;
      width:100%;
      text-align:center;
      padding:15px;
      font-size:0.9rem;
    }
    @media (max-width:600px){
      th, td {font-size:0.9rem;padding:8px;}
      button{padding:6px 10px;font-size:0.9rem;}
    }
  </style>
</head>
<body>

<header>
  <h1>متابعة الحالات</h1>
</header>

<nav>
  <a href="index.html">الرئيسية</a>
  <a href="about.html">عن المستشفى</a>
  <a href="services.html">الخدمات</a>
  <a href="appointment.html">احجز موعدك</a>
  <a href="doctors.html">الاقسام</a>
  <a href="contact.html">تواصل معنا</a>
</nav>

<main>
  <h2>إضافة حالة جديدة</h2>
  <form id="addForm">
    <input type="text" id="name" placeholder="اسم المريض" required>
    <input type="number" id="age" placeholder="العمر" required>
    <input type="text" id="diag" placeholder="التشخيص" required>
    <input type="text" id="notes" placeholder="ملاحظات الطبيب">
    <button type="submit">➕ إضافة الحالة</button>
  </form>

  <input type="text" id="searchInput" placeholder="🔍 ابحث باسم المريض أو التشخيص أو الملاحظات...">

  <h2>سجل حالات المرضى</h2>
  <table id="casesTable">
    <thead>
      <tr>
        <th>الاسم</th>
        <th>العمر</th>
        <th>التشخيص</th>
        <th>الملاحظات</th>
        <th>تحديث</th>
        <th>حذف</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="text-align:center;margin-top:15px;">
    <button class="delete-btn" onclick="confirmDeleteAll()">🧹 حذف جميع الحالات</button>
  </div>
</main>

<!-- نافذة تحديث الملاحظات -->
<div id="popup">
  <div class="popup-content">
    <span class="close-btn" onclick="closePopup()">&times;</span>
    <h3>تحديث الحالة</h3>
    <textarea id="notesInput" placeholder="اكتب ملاحظات الطبيب هنا..."></textarea>
    <button onclick="saveNotes()">حفظ الملاحظات</button>
  </div>
</div>

<!-- نافذة تأكيد الحذف -->
<div id="confirmDelete">
  <div class="popup-content">
    <h3>هل أنت متأكد من الحذف؟</h3>
    <div style="margin-top:15px;">
      <button class="delete-btn" onclick="deleteCase()">نعم، احذف</button>
      <button onclick="closeConfirm()">إلغاء</button>
    </div>
  </div>
</div>

<footer>
  © 2025 مستشفى الشفاء - جميع الحقوق محفوظة
</footer>

<script>
const tableBody = document.querySelector("#casesTable tbody");
const popup = document.getElementById("popup");
const notesInput = document.getElementById("notesInput");
const addForm = document.getElementById("addForm");
const confirmDelete = document.getElementById("confirmDelete");
const searchInput = document.getElementById("searchInput");

let selectedCaseIndex = null;
let cases = JSON.parse(localStorage.getItem("cases")) || [];

function renderTable(filteredCases = cases) {
  tableBody.innerHTML = "";
  if(filteredCases.length === 0){
    tableBody.innerHTML = "<tr><td colspan='6'>لا توجد حالات</td></tr>";
  } else {
    filteredCases.forEach((c, i) => {
      const row = `
        <tr>
          <td>${c.name}</td>
          <td>${c.age}</td>
          <td>${c.diag}</td>
          <td>${c.notes}</td>
          <td><button onclick="openPopup(${i})">✏️ تحديث</button></td>
          <td><button class='delete-btn' onclick="openConfirm(${i})">🗑️ حذف</button></td>
        </tr>
      `;
      tableBody.insertAdjacentHTML("beforeend", row);
    });
  }
}
renderTable();

// بحث فوري
searchInput.addEventListener("input", ()=>{
  const term = searchInput.value.trim().toLowerCase();
  const filtered = cases.filter(c =>
    c.name.toLowerCase().includes(term) ||
    c.diag.toLowerCase().includes(term) ||
    c.notes.toLowerCase().includes(term) ||
    c.age.toString().includes(term)
  );
  renderTable(filtered);
});

// إضافة حالة جديدة
addForm.addEventListener("submit", (e)=>{
  e.preventDefault();
  const newCase = {
    name: document.getElementById("name").value.trim(),
    age: document.getElementById("age").value.trim(),
    diag: document.getElementById("diag").value.trim(),
    notes: document.getElementById("notes").value.trim()
  };
  if(newCase.name && newCase.age && newCase.diag){
    cases.push(newCase);
    localStorage.setItem("cases", JSON.stringify(cases));
    renderTable();
    addForm.reset();
  }
});

// تحديث الحالة
function openPopup(index) {
  selectedCaseIndex = index;
  notesInput.value = cases[index].notes || "";
  popup.classList.add("active");
}
function closePopup() { popup.classList.remove("active"); }
function saveNotes() {
  const newNotes = notesInput.value.trim();
  if (newNotes) {
    cases[selectedCaseIndex].notes = newNotes;
    localStorage.setItem("cases", JSON.stringify(cases));
    renderTable();
    closePopup();
  }
}

// حذف حالة واحدة
function openConfirm(index) {
  selectedCaseIndex = index;
  confirmDelete.classList.add("active");
}
function closeConfirm() { confirmDelete.classList.remove("active"); }
function deleteCase() {
  cases.splice(selectedCaseIndex, 1);
  localStorage.setItem("cases", JSON.stringify(cases));
  renderTable();
  closeConfirm();
}

// حذف جميع الحالات
function confirmDeleteAll() {
  if(confirm("هل أنت متأكد أنك تريد حذف جميع الحالات؟")) {
    cases = [];
    localStorage.removeItem("cases");
    renderTable();
  }
}
</script>

</body>
</html>
